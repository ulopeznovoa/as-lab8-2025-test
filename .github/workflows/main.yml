name: as-lab8

on: [push]

jobs:
  lab8:
    runs-on: ubuntu-latest

    permissions:
      id-token: write
      contents: read
  
    steps:
      - name: Get code
        uses: actions/checkout@v5
      
#      - name: Login to Docker Hub
#        uses: docker/login-action@v3
#        with:
#          username: ${{ secrets.DOCKERHUB_USERNAME }}
#          password: ${{ secrets.DOCKERHUB_TOKEN }}
          
#      - name: Build and push
#        uses: docker/build-push-action@v6
#        with:
#          context: ./app
#          push: true
#          tags: ulopeznovoa/as-lab8-test-2025

      - uses: 'google-github-actions/auth@v3'
        with:
          project_id: 'as-2025-26'
          workload_identity_provider: 'projects/888836629713/locations/global/workloadIdentityPools/as-lab8/providers/github-actions-provider'
          service_account: 'as-lab8-servaccount@as-2025-26.iam.gserviceaccount.com'

      - uses: "google-github-actions/setup-gcloud@v2"
        with:
          install_components: "gke-gcloud-auth-plugin"

      - name: "Get GKE credentials"
        uses: 'google-github-actions/get-gke-credentials@v3'
        with:
          cluster_name: 'as-lab8-cluster'
          location: 'us-south1'

      - name: 'K8S Object Deployment'
        run: |
          kubectl cluster-info
          kubectl get nodes
